require("admin",function(e,n,t){var i=function(){function n(){return i(t,arguments)}var t={en:{"title-home":"Administration page"},fr:{"title-home":"Page d'administration"}},i=e("$").intl;return n.all=t,n}();e("font.josefin"),e("font.mystery-quest");var o=e("dom"),a=e("x-widget").getById,r=e("tfw.web-service"),s=(e("tfw.data-binding"),e("$"),e("tfw.message").error),u=e("tfw.message").info,c=e("wdg.area"),d=e("wdg.modal"),f=e("structure.parser"),l=e("structure"),m={types:"Types de données",patient:"Champs liés au patient",forms:"Formulaire de visite",vaccins:"Liste des vaccins",exams:"Détail des examens possibles"},v={};t.onPage=function(e){if(console.info("[admin] pageId=",e),"Admin"!=e)return void window.setTimeout(function(){a("username").focus=!0},100);l.then(function(){var e,n,t;for(e in m)n=m[e],t=new c({label:n,value:l.source[e]}),v[e]=t,o.add("body."+e,t)})},t.onSave=function(){var e=new d({padding:!0,content:["Sauvegarde en cours..."]});e.attach(),window.setTimeout(function(){var n,t,i=[];for(n in m)t=v[n],console.info("[admin] key=",n),console.info("[admin] val=",t),i.push({id:n,text:t.value,area:t}),console.info("[admin] tasks=",i);var o=function(){if(0==i.length)return void e.detach();var n=i.shift();try{f.parse(n.text)}catch(t){return e.detach(),void d.alert("<html>Il y a une erreur dans le code de <b>"+m[n.id]+"</b> à la ligne <b>"+t.lineNumber+".<pre class='error'>"+t.message+"</pre>",function(){n.area.focus=!0})}r.get("PutOrg",n).then(function(e){console.info("[admin] ret=...",e),l.value[n.id]=n.text,o()},function(e){console.info("[admin] err=...",e),s(e)})};o()})},t.onLogin=function(){var e=a("username").value,n=a("password").value;r.login(e,n).then(function(e){u("Bienvenue !"),l.then(function(){location.hash="#Admin"},function(e){e.context="Loading...",console.error(e),d.alert(i("loading-error",JSON.stringify(e,null,"  ")))})},function(e){console.error(e),s("L'authentification a échoué !"),window.setTimeout(function(){location="index.html"},3e3)})},n.exports._=i});
//# sourceMappingURL=admin.js.map