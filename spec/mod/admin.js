require("admin",function(n,e,t){function i(){return!!s.isLogged()||(r("modal.login").attach(),r("login").focus=!0,!1)}var o=function(){function e(){return i(t,arguments)}var t={en:{"title-home":"Administration page"},fr:{"title-home":"Page d'administration"}},i=n("$").intl;return e.all=t,e}();n("font.josefin"),n("font.mystery-quest");var a=n("dom"),r=n("x-widget").getById,s=n("tfw.web-service"),u=(n("tfw.data-binding"),n("$"),n("tfw.message").error),l=n("tfw.message").info,c=n("wdg.area"),d=n("wdg.modal"),f=n("structure.parser"),m=n("structure"),g={types:"Types de données",patient:"Champs liés au patient",forms:"Formulaire de visite",vaccins:"Liste des vaccins",exams:"Détail des examens possibles"},v={};t.start=function(){m.value.load().then(function(){i()})},t.onPage=function(n){if("Admin"==n){var e,t,i;for(e in g)t=g[e],i=new c({label:t,value:m.value.data[e]}),v[e]=i,a.add("body."+e,i)}},t.onSave=function(){var n=new d({padding:!0,content:["Sauvegarde en cours..."]});n.attach(),window.setTimeout(function(){var e,t,i=[];for(e in g)t=v[e],console.info("[admin] key=",e),console.info("[admin] val=",t),i.push({id:e,text:t.value,area:t}),console.info("[admin] tasks=",i);var o=function(){if(0==i.length)return void n.detach();var e=i.shift();try{f.parse(e.text)}catch(t){return n.detach(),void d.alert("<html>Il y a une erreur dans le code de <b>"+g[e.id]+"</b> à la ligne <b>"+t.lineNumber+".<pre class='error'>"+t.message+"</pre>",function(){e.area.focus=!0})}s.get("PutOrg",e).then(function(n){console.info("[admin] ret=...",n),o()},function(n){console.info("[admin] err=...",n),u(n)})};o()})},t.onLogin=function(){r("modal.login").visible=!1;var n=r("login").value,e=r("password").value;s.login(n,e).then(function(n){l("Bienvenue !"),m.then(function(){location.hash="#Admin"},function(n){n.context="Loading...",console.error(n),d.alert(o("loading-error",JSON.stringify(n,null,"  ")))})},function(n){console.error(n),u("L'authentification a échoué !"),window.setTimeout(function(){location="index.html"},3e3)})},e.exports._=o});
//# sourceMappingURL=admin.js.map