require("admin",function(n,o,t){function e(){return!!s.isLogged()||(c("modal.login").attach(),c("login").focus=!0,!1)}var i=function(){function o(){return e(t,arguments)}var t={en:{"title-home":"Administration page"},fr:{"title-home":"Page d'administration"}},e=n("$").intl;return o.all=t,o}();n("font.josefin"),n("font.mystery-quest");var a,r=n("dom"),c=n("x-widget").getById,s=n("tfw.web-service"),u=(n("tfw.data-binding"),n("$"),n("tfw.message").error),d=n("tfw.message").info,l=n("wdg.modal"),f=n("structure.parser"),g=n("structure");t.start=function(){location.hash="#Loading",g.load().then(function(){"#Loading"!=location.hash?e():location.hash="#Loading"})},t.onPage=function(n){console.info("[admin] pageId=...",n),!e()},t.onSave=function(){try{var n=r("content").value.trim(),o=(f.parse(n),a),t=new l({padding:!0,content:["Sauvegarde en cours..."]});t.attach(),window.setTimeout(function(){s.get("PutOrg",{id:o,text:n}).then(function(n){console.info("[admin] ret=...",n),t.detach(),d("Sauvegarde réussie !")},function(n){console.info("[admin] err=...",n),u(n)})},1e3)}catch(n){u(n),r("content").focus()}},t.onCombo=function(n){a=n;var o=r("content");o.value=""+g.data[n],r.addClass(o,"flash"),window.setTimeout(r.removeClass.bind(r,o,"flash"))},t.onLogin=function(){var n=c("modal.login");n.visible=!1;var o=c("login").value,e=c("password").value;s.login(o,e).then(function(n){d("Bienvenue !"),g.load().then(function(){location.hash="#Admin",t.onCombo("patient")},function(n){n.context="Loading...",console.error(n),l.alert(i("loading-error",JSON.stringify(n,null,"  ")))})},function(o){console.error(o),u("L'authentification a échoué !"),window.setTimeout(function(){n.visible=!0},3e3)})},o.exports._=i});
//# sourceMappingURL=admin.js.map