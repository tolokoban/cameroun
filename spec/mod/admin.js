require("admin",function(n,e,t){function o(){return!!s.isLogged()||(r("modal.login").attach(),r("login").focus=!0,!1)}var i=function(){function e(){return o(t,arguments)}var t={en:{"title-home":"Administration page"},fr:{"title-home":"Page d'administration"}},o=n("$").intl;return e.all=t,e}();n("font.josefin"),n("font.mystery-quest");var a=n("dom"),r=n("x-widget").getById,s=n("tfw.web-service"),d=(n("tfw.data-binding"),n("$"),n("tfw.message").error),u=n("tfw.message").info,c=n("wdg.area"),l=n("wdg.modal"),f=n("structure.parser"),m=n("structure"),g={types:"Types de données",patient:"Champs liés au patient",forms:"Formulaire de visite",vaccins:"Liste des vaccins",exams:"Détail des examens possibles"},v={};t.start=function(){m.load().then(function(){o()})},t.onPage=function(n){if("Admin"==n){var e,t,o;for(e in g)t=g[e],o=new c({label:t,value:m.data[e]}),v[e]=o,a.add("body."+e,o)}},t.onSave=function(){var n=new l({padding:!0,content:["Sauvegarde en cours..."]});n.attach(),window.setTimeout(function(){var e,t,o=[];for(e in g)t=v[e],console.info("[admin] key=",e),console.info("[admin] val=",t),o.push({id:e,text:t.value,area:t}),console.info("[admin] tasks=",o);var i=function(){if(0==o.length)return void n.detach();var e=o.shift();try{f.parse(e.text)}catch(t){return n.detach(),void l.alert("<html>Il y a une erreur dans le code de <b>"+g[e.id]+"</b> à la ligne <b>"+t.lineNumber+".<pre class='error'>"+t.message+"</pre>",function(){e.area.focus=!0})}s.get("PutOrg",e).then(function(n){console.info("[admin] ret=...",n),i()},function(n){console.info("[admin] err=...",n),d(n)})};i()})},t.onLogin=function(){var n=r("modal.login");n.visible=!1;var e=r("login").value,t=r("password").value;s.login(e,t).then(function(n){u("Bienvenue !"),m.load().then(function(){location.hash="#Admin"},function(n){n.context="Loading...",console.error(n),l.alert(i("loading-error",JSON.stringify(n,null,"  ")))})},function(n){console.error(n),d("L'authentification a échoué !"),window.setTimeout(function(){location="index.html"},3e3)})},e.exports._=i});
//# sourceMappingURL=admin.js.map