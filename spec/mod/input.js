require("input",function(e,t){function i(){return f(p,arguments)}function n(e,t,i,n){if(t.type&&"+"==t.type.charAt(t.type.length-1))return void r(t,i,n);var a=c.getValue(i,t.id),d=o(t.type),u=new v({wide:!0,list:d.list,placeholder:y.expand(a.old,t.type),value:y.expand(a.new,t.type)});s.bind(u,"value",function(e){if("string"==typeof e){if(e=e.trim(),0==e.length)delete n.data[t.id];else{var i=d.map[e.toLowerCase()];n.data[t.id]=i||e}c.save()}}),l.add(e,l.div([l.div([t.caption]),l.div([u])])),r(e,u,t,i,n)}function r(e,t,i,n,r){for(var o=i,p=i,f=0,l={},s=a(h.types[i.type],l);null!=(p=u(o));)t=d(e,r,l,t,n,i,p,f,s),f++,o=p}function a(e,t,i,n,r){if("undefined"==typeof e)return[];"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=[]),n.length<=i&&n.push({});var d,u;for(d in e.children)u=e.children[d],t[u.caption.trim().toUpperCase()]=d,i>0&&(n[i-1][r]?n[i-1][r].push(u.caption):n[i-1][r]=[u.caption]),a(u,t,i+1,n,d);return n}function d(e,t,i,n,r,a,d,u,o){var p=h.types[a.type],f=c.getValue(r,d.id),g=new v({wide:!0,placeholder:y.expand(f.old,p,u),value:y.expand(f.new,p,u)});return s.bind(g,"focus",function(e){if(e){var t=n.value.trim().toUpperCase(),r=i[t];g.list=o[u][r||t]||[]}}),s.bind(g,"value",function(e){if("string"==typeof e){if(e=e.trim(),0==e.length)delete t.data[d.id];else{var n=i[e.trim().toUpperCase()];t.data[d.id]=n||e}c.save()}}),l.add(e,l.div([l.div([d.caption]),l.div([g])])),g}function u(e){if("undefined"==typeof e.children)return null;var t;for(t in e.children)return e.children[t];return null}function o(e){if("undefined"==typeof e)return m;if(e=h.types[e],"undefined"==typeof e)return m;if(e=e.children,"undefined"==typeof e)return m;var t,i,n=[],r={};for(t in e)i=e[t],n.push(i.caption),r[i.caption.toLowerCase()]=t;return n.sort(),{list:n,map:r}}var p={en:{},fr:{}},f=require("$").intl,l=require("dom"),s=require("tfw.data-binding"),c=require("data"),v=require("wdg.text"),y=require("format"),h=require("structure"),g=function(e){var t,i=l.elem(this,"div","input");if("undefined"==typeof e.patient)throw Error("[input] Missing mandatory argument: `patient`!");var r=e.patient;t=c.getLastVisit(r);var a=e.def;n(i,a,r,t)},m={list:[],map:{}};t.exports=g,t.exports._=i});
//# sourceMappingURL=input.js.map