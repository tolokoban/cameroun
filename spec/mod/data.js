require("data",function(n,i,t){var s=function(){function i(){return s(t,arguments)}var t={en:{},fr:{}},s=n("$").intl;return i.all=t,i}(),r=n("guid"),a=n("tfw.storage").local,e=(n("structure"),a.get("cameroun",{}));console.info("[data] data=...",e),t.findPatients=function(n,i){"undefined"==typeof i&&(i=5);var t,s;for(t in n)n[t]=n[t].trim().toLowerCase();var r,a,o,u,f,d,c=[];for(r in e){a=e[r],u=0;for(t in n)s=n[t],o=a[t].toLowerCase(),0!=o.length&&(f=s.length/o.length,f>1||(d=o.indexOf(s),d<0||(u=Math.max(0,100*f-d),c.push([u,r]))))}return c.sort(function(n,i){return i[0]-n[0]}),c=c.slice(0,i),c=c.map(function(n){return n[1]})},t.getPatient=function(n){return e[n]},t.newPatient=function(n){var i=r(),s=JSON.parse(JSON.stringify(n));return s.$id=i,s.$admissions=[],e[i]=s,t.save(),i},t.getValue=function(n,i){console.info("[data] patient=...",n);var s=t.getLastVisit(n),r={new:s.data[i]};return Array.isArray(n.$admissions)||(n.$admissions=[]),n.$admissions.forEach(function(n){n.visits.forEach(function(n){var t=n.data;if(t!==r.new){var s=t[i];"undefined"!=typeof s&&s.length>0&&(r.old=s)}})}),r},t.getLastVisit=function(n){if(!Array.isArray(n.$admissions))return null;var i=n.$admissions[n.$admissions.length-1];return i&&Array.isArray(i.visits)?0==i.visits.length?null:i.visits[i.visits.length-1]:null},t.createVisit=function(n){var i;i=Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions[n.$admissions.length-1]:t.createAdmission(n);var s={enter:Date.now(),data:{},prescriptions:[]};return i.visits.push(s),t.save(),s},t.closeVisit=function(n){n.exit=Date.now()},t.createAdmission=function(n){var i={enter:Date.now(),visits:[]};return Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions.push(i):n.$admissions=[i],t.save(),i},t.save=function(){a.set("cameroun",e)},t.export=function(){var n=JSON.stringify(e,null,"  ");return n},i.exports._=s});
//# sourceMappingURL=data.js.map