require("data",function(n,i,t){var e=function(){function i(){return e(t,arguments)}var t={en:{},fr:{}},e=n("$").intl;return i.all=t,i}(),s=n("guid"),a=n("tfw.storage").local,r=(n("structure"),a.get("cameroun",{}));console.info("[data] data=...",r),t.findPatients=function(n,i){"undefined"==typeof i&&(i=5);var t,e;for(t in n)n[t]=n[t].trim().toLowerCase();var s,a,o,c,f,u,d=[];for(s in r){a=r[s],c=0;for(t in n)e=n[t],o=a[t].toLowerCase(),0!=o.length&&(f=e.length/o.length,f>1||(u=o.indexOf(e),u<0||(c=Math.max(0,100*f-u),d.push([c,s]))))}return d.sort(function(n,i){return i[0]-n[0]}),d=d.slice(0,i),d=d.map(function(n){return n[1]})},t.getPatient=function(n){return r[n]},t.newPatient=function(n){var i=s(),e=JSON.parse(JSON.stringify(n));return e.$id=i,e.$admissions=[],r[i]=e,t.save(),i},t.getValue=function(n,i){console.info("[data] patient=...",n);var e=t.getLastVisit(n),s={new:e.data[i]};return Array.isArray(n.$admissions)||(n.$admissions=[]),n.$admissions.forEach(function(n){n.visits.forEach(function(n){var t=n.data;if(t!==s.new){var e=t[i];"undefined"!=typeof e&&e.length>0&&(s.old=e)}})}),s},t.setVaccin=function(n,i,e){"undefined"==typeof n.$vaccins&&(n.$vaccins={});var s=e.date,a=e.lot;"string"!=typeof a&&(a=""),s instanceof Date&&(s=s.toString()),n.$vaccins[i]={date:s,lot:a},t.save()},t.delVaccin=function(n,i){"undefined"!=typeof n.$vaccins&&(delete n.$vaccins[i],t.save())},t.getVaccin=function(n,i){if("undefined"!=typeof n.$vaccins){var t=n.$vaccins[i];if(t&&"string"!=typeof t&&"string"==typeof t.date){var e=new Date(t.date);if(!isNaN(e.getTime())){var s=t.lot;return"string"!=typeof s&&(s=""),{date:e,lot:s}}}}},t.getLastVisit=function(n){if(!Array.isArray(n.$admissions))return null;var i=n.$admissions[n.$admissions.length-1];return i&&Array.isArray(i.visits)?0==i.visits.length?null:i.visits[i.visits.length-1]:null},t.createVisit=function(n){var i;i=Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions[n.$admissions.length-1]:t.createAdmission(n);var e={enter:Date.now(),data:{},prescriptions:[]};return i.visits.push(e),t.save(),e},t.closeVisit=function(n){n.exit=Date.now()},t.createAdmission=function(n){var i={enter:Date.now(),visits:[]};return Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions.push(i):n.$admissions=[i],t.save(),i},t.save=function(){a.set("cameroun",r)},t.export=function(){var n=JSON.stringify(r,null,"  ");return n},i.exports._=e});
//# sourceMappingURL=data.js.map