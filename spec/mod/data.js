require("data",function(n,t,i){var e=function(){function t(){return e(i,arguments)}var i={en:{},fr:{}},e=n("$").intl;return t.all=i,t}(),r=n("guid"),s=n("tfw.storage").local,a=(n("structure"),s.get("cameroun",{}));i.countPatients=function(){var n=0;for(var t in a)n++;return n},i.getAllPatients=function(){var n,t,i=[];for(n in a)t=a[n],i.push([n,t["#PATIENT-LASTNAME"],t["#PATIENT-FIRSTNAME"],t["#PATIENT-BIRTH"]]);return i.sort(function(n,t){var i=n[1]+"     "+n[2]+"     "+n[3],e=t[1]+"     "+t[2]+"     "+t[3];return i<e?-1:i>e?1:0}),i},i.findPatients=function(n,t){"undefined"==typeof t&&(t=5);var i,e;for(i in n)e=n[i],"string"==typeof e&&(n[i]=e.trim().toLowerCase());var r,s,o,u,c,f,d=[];for(r in a){s=a[r],s||console.error("No patient with id: ",r),u=0;for(i in n)e=n[i],o=s[i],o?(o=o.toLowerCase(),0!=o.length&&(c=e.length/o.length,c>1||(f=o.indexOf(e),f<0||(u=Math.max(0,100*c-f),d.push([u,r]))))):console.error("Bad criteria: ",i)}return d.sort(function(n,t){return t[0]-n[0]}),d=d.slice(0,t),d=d.map(function(n){return n[1]})},i.getPatient=function(n){return a[n]},i.newPatient=function(n){var t=r(),e=JSON.parse(JSON.stringify(n));return e.$id=t,e.$admissions=[],a[t]=e,i.save(),t},i.getValue=function(n,t){var e=i.getLastVisit(n),r={new:e.data[t]};return Array.isArray(n.$admissions)||(n.$admissions=[]),n.$admissions.forEach(function(n){n.visits.forEach(function(n){var i=n.data;if(i!==r.new){var e=i[t];"undefined"!=typeof e&&e.length>0&&(r.old=e)}})}),r},i.setVaccin=function(n,t,e){"undefined"==typeof n.$vaccins&&(n.$vaccins={});var r=e.date,s=e.lot;"string"!=typeof s&&(s=""),r instanceof Date&&(r=r.toString()),n.$vaccins[t]={date:r,lot:s},i.save()},i.delVaccin=function(n,t){"undefined"!=typeof n.$vaccins&&(delete n.$vaccins[t],i.save())},i.getVaccin=function(n,t){if("undefined"!=typeof n.$vaccins){var i=n.$vaccins[t];if(i&&"string"!=typeof i&&"string"==typeof i.date){var e=new Date(i.date);if(!isNaN(e.getTime())){var r=i.lot;return"string"!=typeof r&&(r=""),{date:e,lot:r}}}}},i.getLastVisit=function(n){if(!Array.isArray(n.$admissions))return null;var t=n.$admissions[n.$admissions.length-1];return t&&Array.isArray(t.visits)?0==t.visits.length?null:t.visits[t.visits.length-1]:null},i.createVisit=function(n){var t;t=Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions[n.$admissions.length-1]:i.createAdmission(n);var e={enter:Date.now(),data:{},prescriptions:[]};return t.visits.push(e),i.save(),e},i.closeVisit=function(n){n.exit=Date.now()},i.createAdmission=function(n){var t={enter:Date.now(),visits:[]};return Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions.push(t):n.$admissions=[t],i.save(),t},i.save=function(){s.set("cameroun",a)},i.export=function(){var n=JSON.stringify(a,null,"  ");return n},t.exports._=e});
//# sourceMappingURL=data.js.map