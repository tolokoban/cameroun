require("data",function(i,n){function s(){return r(t,arguments)}var t={en:{},fr:{}},r=require("$").intl,e=require("guid"),a=require("tfw.storage").local,o=(require("structure"),a.get("cameroun",{}));console.info("[data] data=...",o),i.findPatients=function(i,n){"undefined"==typeof n&&(n=5);var s,t;for(s in i)i[s]=i[s].trim().toLowerCase();var r,e,a,u,f,d,c=[];for(r in o){e=o[r],u=0;for(s in i)t=i[s],a=e[s].toLowerCase(),0!=a.length&&(f=t.length/a.length,f>1||(d=a.indexOf(t),d<0||(u=Math.max(0,100*f-d),c.push([u,r]))))}return c.sort(function(i,n){return n[0]-i[0]}),c=c.slice(0,n),c=c.map(function(i){return i[1]})},i.getPatient=function(i){return o[i]},i.newPatient=function(n){var s=e(),t=JSON.parse(JSON.stringify(n));return t.$id=s,t.$admissions=[],o[s]=t,i.save(),s},i.getValue=function(n,s){console.info("[data] patient=...",n);var t=i.getLastVisit(n),r={new:t.data[s]};return Array.isArray(n.$admissions)||(n.$admissions=[]),n.$admissions.forEach(function(i){i.visits.forEach(function(i){var n=i.data;if(n!==r.new){var t=n[s];"undefined"!=typeof t&&t.length>0&&(r.old=t)}})}),r},i.getLastVisit=function(i){if(!Array.isArray(i.$admissions))return null;var n=i.$admissions[i.$admissions.length-1];return n&&Array.isArray(n.visits)?0==n.visits.length?null:n.visits[n.visits.length-1]:null},i.createVisit=function(n){var s;s=Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions[n.$admissions.length-1]:i.createAdmission(n);var t={enter:Date.now(),data:{},prescriptions:[]};return s.visits.push(t),i.save(),t},i.closeVisit=function(i){i.exit=Date.now()},i.createAdmission=function(n){var s={enter:Date.now(),visits:[]};return Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions.push(s):n.$admissions=[s],i.save(),s},i.save=function(){a.set("cameroun",o)},i.export=function(){var i=JSON.stringify(o,null,"  ");return i},n.exports._=s});
//# sourceMappingURL=data.js.map