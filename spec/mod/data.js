require("data",function(n,i,t){var s=function(){function i(){return s(t,arguments)}var t={en:{},fr:{}},s=n("$").intl;return i.all=t,i}(),e=n("guid"),a=n("tfw.storage").local,r=(n("structure"),a.get("cameroun",{}));console.info("[data] data=...",r),t.findPatients=function(n,i){"undefined"==typeof i&&(i=5);var t,s;for(t in n)n[t]=n[t].trim().toLowerCase();var e,a,o,c,u,f,d=[];for(e in r){a=r[e],c=0;for(t in n)s=n[t],o=a[t].toLowerCase(),0!=o.length&&(u=s.length/o.length,u>1||(f=o.indexOf(s),f<0||(c=Math.max(0,100*u-f),d.push([c,e]))))}return d.sort(function(n,i){return i[0]-n[0]}),d=d.slice(0,i),d=d.map(function(n){return n[1]})},t.getPatient=function(n){return r[n]},t.newPatient=function(n){var i=e(),s=JSON.parse(JSON.stringify(n));return s.$id=i,s.$admissions=[],r[i]=s,t.save(),i},t.getValue=function(n,i){console.info("[data] patient=...",n);var s=t.getLastVisit(n),e={new:s.data[i]};return Array.isArray(n.$admissions)||(n.$admissions=[]),n.$admissions.forEach(function(n){n.visits.forEach(function(n){var t=n.data;if(t!==e.new){var s=t[i];"undefined"!=typeof s&&s.length>0&&(e.old=s)}})}),e},t.setVaccin=function(n,i,s){"undefined"==typeof n.$vaccins&&(n.$vaccins={}),s instanceof Date&&(s=s.toString()),n.$vaccins[i]=s,t.save()},t.delVaccin=function(n,i){"undefined"!=typeof n.$vaccins&&(delete n.$vaccins[i],t.save())},t.getVaccin=function(n,i){if("undefined"!=typeof n.$vaccins){var t=n.$vaccins[i];return"string"!=typeof t?t:new Date(t)}},t.getLastVisit=function(n){if(!Array.isArray(n.$admissions))return null;var i=n.$admissions[n.$admissions.length-1];return i&&Array.isArray(i.visits)?0==i.visits.length?null:i.visits[i.visits.length-1]:null},t.createVisit=function(n){var i;i=Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions[n.$admissions.length-1]:t.createAdmission(n);var s={enter:Date.now(),data:{},prescriptions:[]};return i.visits.push(s),t.save(),s},t.closeVisit=function(n){n.exit=Date.now()},t.createAdmission=function(n){var i={enter:Date.now(),visits:[]};return Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions.push(i):n.$admissions=[i],t.save(),i},t.save=function(){a.set("cameroun",r)},t.export=function(){var n=JSON.stringify(r,null,"  ");return n},i.exports._=s});
//# sourceMappingURL=data.js.map