require("data",function(n,i,s){function t(){return a(r,arguments)}var r={en:{},fr:{}},a=n("$").intl,e=n("guid"),o=n("tfw.storage").local,u=(n("structure"),o.get("cameroun",{}));console.info("[data] data=...",u),s.findPatients=function(n,i){"undefined"==typeof i&&(i=5);var s,t;for(s in n)n[s]=n[s].trim().toLowerCase();var r,a,e,o,f,d,c=[];for(r in u){a=u[r],o=0;for(s in n)t=n[s],e=a[s].toLowerCase(),0!=e.length&&(f=t.length/e.length,f>1||(d=e.indexOf(t),d<0||(o=Math.max(0,100*f-d),c.push([o,r]))))}return c.sort(function(n,i){return i[0]-n[0]}),c=c.slice(0,i),c=c.map(function(n){return n[1]})},s.getPatient=function(n){return u[n]},s.newPatient=function(n){var i=e(),t=JSON.parse(JSON.stringify(n));return t.$id=i,t.$admissions=[],u[i]=t,s.save(),i},s.getValue=function(n,i){console.info("[data] patient=...",n);var t=s.getLastVisit(n),r={new:t.data[i]};return Array.isArray(n.$admissions)||(n.$admissions=[]),n.$admissions.forEach(function(n){n.visits.forEach(function(n){var s=n.data;if(s!==r.new){var t=s[i];"undefined"!=typeof t&&t.length>0&&(r.old=t)}})}),r},s.getLastVisit=function(n){if(!Array.isArray(n.$admissions))return null;var i=n.$admissions[n.$admissions.length-1];return i&&Array.isArray(i.visits)?0==i.visits.length?null:i.visits[i.visits.length-1]:null},s.createVisit=function(n){var i;i=Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions[n.$admissions.length-1]:s.createAdmission(n);var t={enter:Date.now(),data:{},prescriptions:[]};return i.visits.push(t),s.save(),t},s.closeVisit=function(n){n.exit=Date.now()},s.createAdmission=function(n){var i={enter:Date.now(),visits:[]};return Array.isArray(n.$admissions)&&0!=n.$admissions.length?n.$admissions.push(i):n.$admissions=[i],s.save(),i},s.save=function(){o.set("cameroun",u)},s.export=function(){var n=JSON.stringify(u,null,"  ");return n},i.exports._=t});
//# sourceMappingURL=data.js.map