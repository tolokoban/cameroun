require("page.patient",function(e,t,i){function n(e){e?(v.addClass(this,"theme-elevation-8","theme-color-bg-A4"),v.removeClass(this,"theme-elevation-2","theme-color-bg-A1")):(v.removeClass(this,"theme-elevation-8","theme-color-bg-A4"),v.addClass(this,"theme-elevation-2","theme-color-bg-A1"))}function a(e){d=e,u("vaccin-edit").attach(),v("vaccin-name").textContent=p.vaccins[e].caption;var t=g.getVaccin(s,e)||{},i=t.date;i||(i=new Date),u("vaccin-date").value=i,u("vaccin-lot").value=t.lot||""}function o(){v.clear("vaccins");var e,t,i;for(e in p.vaccins){t=p.vaccins[e].caption;var o=g.getVaccin(s,e);if(o){var c=o.date,l=Math.ceil((Date.now()-c.getTime())/315576e5);i=v.div("theme-elevation-2","level-"+(l<6?"0":l<11?"1":"2"),[v.div([t]),v.div([l<2?"Moins d'un an":l+" ans"])])}else i=v.div("theme-elevation-2","level-3",[v.div([t]),v.div("unknown",["Inconnu..."])]);v.add("vaccins",i),v.on(i,{down:n.bind(i,!0),up:n.bind(i,!1),tap:a.bind(i,e)})}}function c(){u("vaccin-edit").detach(),o()}var s,l,d,r=function(){function t(){return n(i,arguments)}var i={en:{},fr:{}},n=e("$").intl;return t.all=i,t}(),v=e("dom"),u=e("x-widget").getById,m=e("tfw.message").error,g=e("data"),h=e("wdg.modal"),f=e("format"),p=e("structure");i.onPage=function(){var e=location.hash.split("/"),t=e[1];l=t,s=g.getPatient(t),document.getElementById("patient.title").textContent=f.getPatientCaption(s);var i=document.getElementById("patient.hint"),n=u("patient.exit");if(n.visible=!1,Array.isArray(s.$admissions)&&0!=s.$admissions.length){var a=s.$admissions[s.$admissions.length-1];"undefined"==typeof a.exit?(i.innerHTML="Ce patient est admis dans ce service depuis<br/><b>"+f.date(a.enter)+"</b>.",n.visible=!0):i.innerHTML="Ce patient a été admis dans ce service du <ul><li><b>"+f.date(a.enter)+"</b></li><li>au <b>"+f.date(a.exit)+"</b>.</li></ul>"}else i.textContent="Ce patient n'a encore jamais été admis dans ce service.";o()},i.onVaccinOK=function(){var e=u("vaccin-date").value;return e.getTime()>Date.now()?void m("La date spécifiée est dans le futur !"):(g.setVaccin(s,d,{date:e,lot:u("vaccin-lot").value}),console.info("[page.patient] Data.getPatient(g_patient)=...",g.getPatient(s)),void c())},i.onVaccinDel=function(){g.delVaccin(s,d),c()},i.onExam=function(){console.info("[page.patient] g_patient=",s),location="#Exam/"+l},i.onNewVisit=function(){var e=g.getLastVisit(s);if(!e||e.exit)e=g.createVisit(s),location.hash="#Visit/"+s.$id;else{var t=v.div(["Une visite débutée ",v.tag("b",[f.date(e.enter)])," n'a pas été cloturée.",v.tag("br"),"Voulez-vous la poursuivre ?",v.tag("hr"),v.tag("em",["Si vous choisissez NON, nous créerons une nouvelle visite."])]);h.confirm(t,function(){location.hash="#Visit/"+s.$id},function(){e.exit=e.enter,g.createVisit(s),location.hash="#Visit/"+s.$id})}},t.exports._=r});
//# sourceMappingURL=page.patient.js.map