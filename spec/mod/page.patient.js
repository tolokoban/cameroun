require("page.patient",function(e,t,i){function n(e){e?(r.addClass(this,"theme-elevation-8","theme-color-bg-A4"),r.removeClass(this,"theme-elevation-2","theme-color-bg-A1")):(r.removeClass(this,"theme-elevation-8","theme-color-bg-A4"),r.addClass(this,"theme-elevation-2","theme-color-bg-A1"))}function a(e){d=e,v("vaccin-edit").attach(),r("vaccin-name").textContent=f.vaccins[e].caption;var t=m.getVaccin(s,e)||{},i=t.date;i||(i=new Date),v("vaccin-date").value=i,v("vaccin-lot").value=t.lot||""}function o(){r.clear("vaccins");var e,t,i;for(e in f.vaccins){t=f.vaccins[e].caption;var o=m.getVaccin(s,e);if(o){var c=o.date,d=Math.ceil((Date.now()-c.getTime())/315576e5);i=r.div("theme-elevation-2","level-"+(d<6?"0":d<11?"1":"2"),[r.div([t]),r.div([d<2?"Moins d'un an":d+" ans"])])}else i=r.div("theme-elevation-2","level-3",[r.div([t]),r.div("unknown",["Inconnu..."])]);r.add("vaccins",i),r.on(i,{down:n.bind(i,!0),up:n.bind(i,!1),tap:a.bind(i,e)})}}function c(){v("vaccin-edit").detach(),o()}var s,d,l=function(){function t(){return n(i,arguments)}var i={en:{},fr:{}},n=e("$").intl;return t.all=i,t}(),r=e("dom"),v=e("x-widget").getById,u=e("tfw.message").error,m=e("data"),h=e("wdg.modal"),g=e("format"),f=e("structure");i.onPage=function(){var e=location.hash.split("/"),t=e[1];s=m.getPatient(t),document.getElementById("patient.title").textContent=g.getPatientCaption(s);var i=document.getElementById("patient.hint"),n=v("patient.exit");if(n.visible=!1,Array.isArray(s.$admissions)&&0!=s.$admissions.length){var a=s.$admissions[s.$admissions.length-1];"undefined"==typeof a.exit?(i.innerHTML="Ce patient est admis dans ce service depuis<br/><b>"+g.date(a.enter)+"</b>.",n.visible=!0):i.innerHTML="Ce patient a été admis dans ce service du <ul><li><b>"+g.date(a.enter)+"</b></li><li>au <b>"+g.date(a.exit)+"</b>.</li></ul>"}else i.textContent="Ce patient n'a encore jamais été admis dans ce service.";o()},i.onVaccinOK=function(){var e=v("vaccin-date").value;return e.getTime()>Date.now()?void u("La date spécifiée est dans le futur !"):(m.setVaccin(s,d,{date:e,lot:v("vaccin-lot").value}),console.info("[page.patient] Data.getPatient(g_patient)=...",m.getPatient(s)),void c())},i.onVaccinDel=function(){m.delVaccin(s,d),c()},i.onNewVisit=function(){var e=m.getLastVisit(s);if(!e||e.exit)e=m.createVisit(s),location.hash="#Visit/"+s.$id;else{var t=r.div(["Une visite débutée ",r.tag("b",[g.date(e.enter)])," n'a pas été cloturée.",r.tag("br"),"Voulez-vous la poursuivre ?",r.tag("hr"),r.tag("em",["Si vous choisissez NON, nous créerons une nouvelle visite."])]);h.confirm(t,function(){location.hash="#Visit/"+s.$id},function(){e.exit=e.enter,m.createVisit(s),location.hash="#Visit/"+s.$id})}},t.exports._=l});
//# sourceMappingURL=page.patient.js.map