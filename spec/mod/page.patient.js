require("page.patient",function(e,t,i){function n(e){e?(v.addClass(this,"theme-elevation-8","theme-color-bg-A4"),v.removeClass(this,"theme-elevation-2","theme-color-bg-A1")):(v.removeClass(this,"theme-elevation-8","theme-color-bg-A4"),v.addClass(this,"theme-elevation-2","theme-color-bg-A1"))}function a(e){l=e,u("vaccin-edit").attach(),v("vaccin-name").textContent=p.vaccins[e].caption;var t=h.getVaccin(s,e)||{},i=t.date;i||(i=new Date),u("vaccin-date").value=i,u("vaccin-lot").value=t.lot||""}function o(){v.clear("vaccins");var e,t,i;for(e in p.vaccins){t=p.vaccins[e].caption;var o=h.getVaccin(s,e);if(o){var c=o.date,d=Math.ceil((Date.now()-c.getTime())/315576e5);i=v.div("theme-elevation-2","level-"+(d<6?"0":d<11?"1":"2"),[v.div([t]),v.div([d<2?"Moins d'un an":d+" ans"])])}else i=v.div("theme-elevation-2","level-3",[v.div([t]),v.div("unknown",["Inconnu..."])]);v.add("vaccins",i),v.on(i,{down:n.bind(i,!0),up:n.bind(i,!1),tap:a.bind(i,e)})}}function c(){u("vaccin-edit").detach(),o()}var s,d,l,r=function(){function t(){return n(i,arguments)}var i={en:{},fr:{}},n=e("$").intl;return t.all=i,t}(),v=e("dom"),u=e("x-widget").getById,m=e("tfw.message").error,h=e("data"),f=e("wdg.modal"),g=e("format"),p=e("structure");i.onPage=function(){var e=location.hash.split("/"),t=e[1];d=t,s=h.getPatient(t),document.getElementById("patient.title").textContent=g.getPatientCaption(s);var i=document.getElementById("patient.hint"),n=u("patient.exit");if(n.visible=!1,Array.isArray(s.$admissions)&&0!=s.$admissions.length){var a=s.$admissions[s.$admissions.length-1];"undefined"==typeof a.exit?(i.innerHTML="Ce patient est admis dans ce service depuis<br/><b>"+g.date(a.enter)+"</b>.",n.visible=!0):i.innerHTML="Ce patient a été admis dans ce service du <ul><li><b>"+g.date(a.enter)+"</b></li><li>au <b>"+g.date(a.exit)+"</b>.</li></ul>"}else i.textContent="Ce patient n'a encore jamais été admis dans ce service.";o()},i.onVaccinOK=function(){var e=u("vaccin-date").value;return e.getTime()>Date.now()?void m("La date spécifiée est dans le futur !"):(h.setVaccin(s,l,{date:e,lot:u("vaccin-lot").value}),void c())},i.onVaccinDel=function(){h.delVaccin(s,l),c()},i.onExam=function(){location="#Exam/"+d},i.onNewVisit=function(){var e=h.getLastVisit(s);if(!e||e.exit)e=h.createVisit(s),location.hash="#Visit/"+s.$id;else{var t=v.div(["Une visite débutée ",v.tag("b",[g.date(e.enter)])," n'a pas été cloturée.",v.tag("br"),"Voulez-vous la poursuivre ?",v.tag("hr"),v.tag("em",["Si vous choisissez NON, nous créerons une nouvelle visite."])]);f.confirm(t,function(){location.hash="#Visit/"+s.$id},function(){e.exit=e.enter,h.createVisit(s),location.hash="#Visit/"+s.$id})}},t.exports._=r});
//# sourceMappingURL=page.patient.js.map