require("page.patient",function(e,t,i){function n(e){e?(l.addClass(this,"theme-elevation-8","theme-color-bg-A4"),l.removeClass(this,"theme-elevation-2","theme-color-bg-A1")):(l.removeClass(this,"theme-elevation-8","theme-color-bg-A4"),l.addClass(this,"theme-elevation-2","theme-color-bg-A1"))}function a(e){r=e,v("vaccin-edit").attach(),l("vaccin-name").textContent=f.vaccins[e].caption;var t=m.getVaccin(c,e);t?v("vaccin-date").value=t:t=new Date}function o(){l.clear("vaccins");var e,t,i;for(e in f.vaccins){t=f.vaccins[e].caption;var o=m.getVaccin(c,e);if(o){var s=Math.ceil((Date.now()-o.getTime())/315576e5);i=l.div("theme-elevation-2","level-"+(s<6?"0":s<11?"1":"2"),[l.div([t]),l.div([s<2?"Moins d'un an":s+" ans"])])}else i=l.div("theme-elevation-2","level-3",[l.div([t]),l.div("unknown",["Inconnu..."])]);l.add("vaccins",i),l.on(i,{down:n.bind(i,!0),up:n.bind(i,!1),tap:a.bind(i,e)})}}function s(){v("vaccin-edit").detach(),o()}var c,r,d=function(){function t(){return n(i,arguments)}var i={en:{},fr:{}},n=e("$").intl;return t.all=i,t}(),l=e("dom"),v=e("x-widget").getById,u=e("tfw.message").error,m=e("data"),h=e("wdg.modal"),g=e("format"),f=e("structure");i.onPage=function(){var e=location.hash.split("/"),t=e[1];c=m.getPatient(t),document.getElementById("patient.title").textContent=g.getPatientCaption(c);var i=document.getElementById("patient.hint"),n=v("patient.exit");if(n.visible=!1,Array.isArray(c.$admissions)&&0!=c.$admissions.length){var a=c.$admissions[c.$admissions.length-1];"undefined"==typeof a.exit?(i.innerHTML="Ce patient est admis dans ce service depuis<br/><b>"+g.date(a.enter)+"</b>.",n.visible=!0):i.innerHTML="Ce patient a été admis dans ce service du <ul><li><b>"+g.date(a.enter)+"</b></li><li>au <b>"+g.date(a.exit)+"</b>.</li></ul>"}else i.textContent="Ce patient n'a encore jamais été admis dans ce service.";o()},i.onVaccinOK=function(){var e=v("vaccin-date").value;return e.getTime()>Date.now()?void u("La date spécifiée est dans le futur !"):(m.setVaccin(c,r,e),console.info("[page.patient] Data.getPatient(g_patient)=...",m.getPatient(c)),void s())},i.onVaccinDel=function(){m.delVaccin(c,r),s()},i.onNewVisit=function(){var e=m.getLastVisit(c);if(!e||e.exit)e=m.createVisit(c),location.hash="#Visit/"+c.$id;else{var t=l.div(["Une visite débutée ",l.tag("b",[g.date(e.enter)])," n'a pas été cloturée.",l.tag("br"),"Voulez-vous la poursuivre ?",l.tag("hr"),l.tag("em",["Si vous choisissez NON, nous créerons une nouvelle visite."])]);h.confirm(t,function(){location.hash="#Visit/"+c.$id},function(){e.exit=e.enter,m.createVisit(c),location.hash="#Visit/"+c.$id})}},t.exports._=d});
//# sourceMappingURL=page.patient.js.map