require("page.patient",function(e,t,n){function i(e){e?(r.addClass(this,"theme-elevation-8","theme-color-bg-A4"),r.removeClass(this,"theme-elevation-2","theme-color-bg-A1")):(r.removeClass(this,"theme-elevation-8","theme-color-bg-A4"),r.addClass(this,"theme-elevation-2","theme-color-bg-A1"))}function a(e){d=e,u("vaccin-edit").attach(),r("vaccin-name").textContent=p.value.vaccins[e].caption;var t=s.vaccins[e]||{},n=t.date;n||(n=f.now()),u("vaccin-date").value=n,u("vaccin-lot").value=t.lot||""}function o(){r.clear("vaccins");var e,t,n;for(e in p.value.vaccins){t=p.value.vaccins[e].caption;var o=s.vaccins[e];if(o){var c=(o.date,f.age(o.date)/31557600);n=r.div("theme-elevation-2","level-"+(c<6?"0":c<11?"1":"2"),[r.div([t]),r.div([c<2?"Moins d'un an":c+" ans"])])}else n=r.div("theme-elevation-2","level-3",[r.div([t]),r.div("unknown",["Inconnu..."])]);r.add("vaccins",n),r.on(n,{down:i.bind(n,!0),up:i.bind(n,!1),tap:a.bind(n,e)})}}function c(){u("vaccin-edit").detach(),o()}var s,l,d,v=function(){function t(){return i(n,arguments)}var n={en:{},fr:{}},i=e("$").intl;return t.all=n,t}(),r=e("dom"),u=e("x-widget").getById,m=e("tfw.message").error,h=(e("wdg.modal"),e("format")),f=e("date"),g=e("patients"),p=e("structure");n.onPage=function(){var e=location.hash.split("/"),t=e[1];l=t,g.get(t).then(function(e){s=e,document.getElementById("patient.title").textContent=h.getPatientCaption(s.data);var t=document.getElementById("patient.hint"),n=u("patient.exit");if(n.visible=!1,Array.isArray(s.admissions)&&0!=s.admissions.length){var i=s.admissions[s.admissions.length-1];void 0===i.exit?(t.innerHTML="Ce patient est admis dans ce service depuis<br/><b>"+h.date(i.enter)+"</b>.",n.visible=!0):t.innerHTML="Ce patient a déjà été admis dans ce service du <ul><li><b>"+h.date(i.enter)+"</b></li><li>au <b>"+h.date(i.exit)+"</b>.</li></ul>"}else t.textContent="Ce patient n'a encore jamais été admis dans ce service.";o()},m)},n.onVaccinOK=function(){console.log("onVaccinOK");var e=u("vaccin-date").value;console.info("[page.patient] ymd=",e);var t=f.fromYMD(e);if(console.info("[page.patient] dat=",t),f.age(t)<0)return void m("La date spécifiée est dans le futur !");s.vaccins[d]={date:t,lot:u("vaccin-lot").value},g.save(s),c()},n.onVaccinDel=function(){delete s.vaccins[d],g.save(s),c()},n.onExam=function(){location="#Exam/"+l},n.onNewVisit=function(){var e=g.lastVisit(s);!e||e.exit||Date.age(e.enter)>3600?(e.exit||(e.exit=f.now()),g.createVisit().then(function(e){location.hash="#Visit/"+l})):location.hash="#Visit/"+s.$id},t.exports._=v});
//# sourceMappingURL=page.patient.js.map