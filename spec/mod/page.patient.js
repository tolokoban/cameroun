require("page.patient",function(e,t,i){function n(e){e?(r.addClass(this,"theme-elevation-8","theme-color-bg-A4"),r.removeClass(this,"theme-elevation-2","theme-color-bg-A1")):(r.removeClass(this,"theme-elevation-8","theme-color-bg-A4"),r.addClass(this,"theme-elevation-2","theme-color-bg-A1"))}function a(e){v=e,u("vaccin-edit").attach(),r("vaccin-name").textContent=p.value.vaccins[e].caption;var t=s.vaccins[e]||{},i=t.date;u("vaccin-date").value=i,u("vaccin-lot").value=t.lot||""}function o(){r.clear("vaccins");var e,t,i;for(e in p.value.vaccins){t=p.value.vaccins[e].caption;var o=s.vaccins[e];if(o){var c=(o.date,Math.floor(g.age(o.date)/31557600));i=r.div("theme-elevation-2","level-"+(c<6?"0":c<11?"1":"2"),[r.div([t]),r.div([c<2?"Moins d'un an":c+" ans"])])}else i=r.div("theme-elevation-2","level-3",[r.div([t]),r.div("unknown",["Inconnu..."])]);r.add("vaccins",i),r.on(i,{down:n.bind(i,!0),up:n.bind(i,!1),tap:a.bind(i,e)})}}function c(){u("vaccin-edit").detach(),o()}var s,d,v,l=function(){function t(){return n(i,arguments)}var i={en:{},fr:{}},n=e("$").intl;return t.all=i,t}(),r=e("dom"),u=e("x-widget").getById,m=e("tfw.message").error,f=e("wdg.modal"),h=e("format"),g=e("date"),b=e("patients"),p=e("structure"),x=e("modal.patient");i.onPage=function(){var e=location.hash.split("/"),t=e[1];d=t,b.get(t).then(function(e){s=e,document.getElementById("patient.title").textContent=h.getPatientCaption(s.data);var t=document.getElementById("patient.hint"),i=u("patient.exit");if(i.visible=!1,Array.isArray(s.admissions)&&0!=s.admissions.length){var n=s.admissions[s.admissions.length-1];void 0===n.exit?(t.innerHTML="Ce patient est admis dans ce service depuis<br/><b>"+h.date(n.enter)+"</b>.",i.visible=!0):t.innerHTML="Ce patient a déjà été admis dans ce service du <ul><li><b>"+h.date(n.enter)+"</b></li><li>au <b>"+h.date(n.exit)+"</b>.</li></ul>"}else t.textContent="Ce patient n'a encore jamais été admis dans ce service.";o()},m)},i.onVaccinOK=function(){var e=u("vaccin-date").value;return"number"!=typeof e?(m("La date est obligatoire !"),void(u("vaccin-date").focus=!0)):g.age(e)<0?(m("La date spécifiée est dans le futur !"),void(u("vaccin-date").focus=!0)):(s.vaccins[v]={date:e,lot:u("vaccin-lot").value},b.save(s),void c())},i.onVaccinDel=function(){delete s.vaccins[v],b.save(s),c()},i.onExam=function(){location="#Exam/"+d},i.onNewVisit=function(){var e=b.lastVisit(s);!e||e.exit||g.age(e.enter)>3600?(e&&!e.exit&&(e.exit=g.now()),b.createVisit(s).then(function(e){location.hash="#Visit/"+d})):location.hash="#Visit/"+d},i.onPatientExit=function(){f.confirm("<html>Confirmez vous que le patient<br/><b>"+h.getPatientCaption(s.data)+"</b><br/>est sorti du service ?",function(){var e=b.lastVisit(s);e.exit||(e.exit=g.now());var t=s.admissions.length;s.admissions[t-1].exit=g.now(),b.save(s).then(function(){i.onPage()})})},i.onPatientEdit=function(){x("Editer l'identité du patient",s,function(e){s.data=e,b.save(s).then(i.onPage.bind(i))})},t.exports._=l});
//# sourceMappingURL=page.patient.js.map