require("wdg.text",function(e,t,l){var a=function(){function t(){return a(l,arguments)}var l={en:{}},a=e("$").intl;return t.all=l,t}(),i=e("dom"),n=e("tfw.data-binding"),o=e("wdg.lang"),s=e("tfw.timer").laterAction,r=function(e){var t=this,l=!1,a=[],r=0,u=i.div("theme-label","theme-color-bg-1"),v=i.tag("input"),d=new o({small:!0,visible:!0}),p=i.div("nowrap",[v,d]),c=i.div("datalist","theme-elevation-12");this._input=v;var f=i.elem(this,"div","wdg-text","theme-elevation-2",[u,p,c]);n.bind(d,"value",function(e){v.value=t.value[e]||"",t.focus||v.focus()}),n.prop(this,"value")(function(e){if(null!==e&&"undefined"!=typeof e||(e=""),"number"!=typeof e&&"boolean"!=typeof e||(e=""+e),"string"!=typeof e){v.value!=e[d.value]&&(v.value=e[d.value]);var l,a=[];for(l in e)a.push(l);d.subset=a,t.intl=!0}else v.value!=e&&(v.value=e),t.intl=!1;t.validate()}),n.propBoolean(this,"intl")(function(e){d.visible=e}),n.propEnum(["text","button","checkbox","color","date","datetime","email","file","hidden","image","month","password","radio","range","reset","search","submit","tel","time","url","week"])(this,"type")(function(e){i.att(v,{type:e})}),n.propStringArray(this,"list")(function(e){i.clear(c),i.removeClass(f,"list"),Array.isArray(e)&&(e.forEach(function(e){i.add(c,i.div([e]))}),e.length>0&&i.att(f,"list"))}),n.propValidator(this,"validator")(this.validate.bind(this)),n.propBoolean(this,"valid")(function(e){null!==e&&t.validator?e?(i.addClass(f,"valid"),i.removeClass(f,"no-valid")):(i.removeClass(f,"valid"),i.addClass(f,"no-valid")):i.removeClass(f,"valid","no-valid")}),n.propBoolean(this,"enabled")(function(e){e?i.removeAtt(v,"disabled"):i.att(v,{disabled:e})}),n.propInteger(this,"size")(function(e){e<1?i.removeAtt(v,"size"):i.att(v,{size:e})}),n.propString(this,"label")(function(e){null===e||"string"==typeof e&&""==e.trim()?i.addClass(f,"no-label"):(i.removeClass(f,"no-label"),i.textOrHtml(u,e),"<html>"==e.substr(0,6)?i.att(u,{title:""}):i.att(u,{title:e}))}),n.propString(this,"placeholder")(function(e){i.att(v,{placeholder:e})}),n.propString(this,"width")(function(e){f.style.width=e}),n.propBoolean(this,"focus")(function(e){e?v.focus():v.blur()}),n.propInteger(this,"action",""),n.propAddClass(this,"wide"),n.propRemoveClass(this,"visible","hide"),e=n.extend({intl:!1,value:"",type:"text",placeholder:"",enabled:!0,validator:null,valid:!0,list:null,label:"",placeholder:"",size:10,width:"auto",focus:!1,wide:!1,visible:!0},e,this);var h=function(){if(i.removeClass(f,"list"),t.list&&0!=t.list.length){i.clear(c);var e=t.list.map(String.toLowerCase),n=v.value.trim().toLowerCase();e=n.length>0?e.map(function(e,t){return[t,e.indexOf(n)]}).filter(function(e){return e[1]>-1}).sort(function(e,l){var a=e[1]-l[1];if(0!=a)return a;var i=t.list[e[0]],n=t.list[l[0]];return i<n?-1:i>n?1:0}).map(function(e){var l=t.list[e[0]],a=e[1];return l.substr(0,a)+"<b>"+l.substr(a,n.length)+"</b>"+l.substr(a+n.length)}):e.sort(),r>0&&(e=e.slice(r).concat(e.slice(0,r))),a=e,e.forEach(function(a,n){var o=i.div();o.innerHTML=a,e[n]=o.textContent.trim(),i.add(c,o),i.on(o,{down:function(){l=!0},up:function(){l=!1,t.focus=!0},tap:function(){t.value=o.textContent.trim(),i.removeClass(f,"list")}})}),e.length>0?i.addClass(f,"list"):i.removeClass(f,"list")}},m=s(function(){t.intl?(t.value[d.value]=v.value,n.fire(t,"value",t.value)):t.value=v.value},300);v.addEventListener("keyup",function(e){13==e.keyCode?(e.preventDefault(),e.stopPropagation(),i.hasClass(f,"list")?(i.removeClass(f,"list"),t.value=a[0]):t.valid!==!1&&(n.fire(t,"value",v.value),n.fire(t,"action",v.value))):27==e.keyCode?(i.removeClass(f,"list"),r=0,e.preventDefault(),e.stopPropagation()):40==e.keyCode&&i.hasClass(f,"list")?(r=(r+1)%a.length,h(),e.preventDefault(),e.stopPropagation()):38==e.keyCode&&i.hasClass(f,"list")?(r=(r+a.length-1)%a.length,h(),e.preventDefault(),e.stopPropagation()):(r=0,h(),m.fire())}),v.addEventListener("blur",function(){t.intl?(t.value[d.value]=v.value,n.fire(t,"value",t.value)):t.value=v.value,l||i.removeClass(f,"list"),i.addClass(f,"theme-elevation-2"),i.removeClass(f,"theme-elevation-8"),i.removeClass(v,"theme-color-bg-A1"),n.set(t,"focus",!1)}),v.addEventListener("focus",function(){t.selectAll(),i.removeClass(f,"theme-elevation-2"),i.addClass(f,"theme-elevation-8"),i.addClass(v,"theme-color-bg-A1"),n.set(t,"focus",!0)}),v.addEventListener("keydown",function(e){}),this.validate()};r.prototype.validate=function(){var e=this.validator;if(e)try{this.valid=e(this.value)}catch(t){console.error("[wdg.text:validate] Exception = ",t),console.error("[wdg.text:validate] Validator = ",e)}},r.prototype.selectAll=function(){var e=this._input;return e.setSelectionRange(0,e.value.length),!0},t.exports=r,t.exports._=a});
//# sourceMappingURL=wdg.text.js.map