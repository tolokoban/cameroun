require("wdg.text",function(t,e,l){var a=function(){function e(){return a(l,arguments)}var l={en:{}},a=t("$").intl;return e.all=l,e}(),i=t("dom"),o=t("tfw.data-binding"),n=t("wdg.lang"),s=t("tfw.timer").laterAction,r=function(t){var e=this,l=!1,a=[],r=0,u=i.div("theme-label","theme-color-bg-1"),v=i.tag("input"),d=new n({small:!0,visible:!0}),c=i.div("nowrap",[v,d]),p=i.div("datalist","theme-elevation-12");this._input=v;var f=i.elem(this,"div","wdg-text","theme-elevation-2",[u,c,p]);o.bind(d,"value",function(t){v.value=e.value[t]||"",e.focus||v.focus()}),o.prop(this,"value")(function(t){if(null!==t&&void 0!==t||(t=""),"number"!=typeof t&&"boolean"!=typeof t||(t=""+t),"string"!=typeof t){v.value!=t[d.value]&&(v.value=t[d.value]);var l,a=[];for(l in t)a.push(l);d.subset=a,e.intl=!0}else v.value!=t&&(v.value=t),e.intl=!1;e.validate()}),o.propBoolean(this,"intl")(function(t){d.visible=t}),o.propEnum(["text","button","checkbox","color","date","datetime","email","file","hidden","image","month","password","radio","range","reset","search","submit","tel","time","url","week"])(this,"type")(function(t){i.att(v,{type:t}),"password"==t&&i.att(v,{autocomplete:"off"})}),o.propStringArray(this,"list")(function(t){i.clear(p),i.removeClass(f,"list"),Array.isArray(t)&&(t.forEach(function(t){i.add(p,i.div([t]))}),t.length>0&&i.att(f,"list"))}),o.propValidator(this,"validator")(this.validate.bind(this)),o.propBoolean(this,"valid")(function(t){null!==t&&e.validator?t?(i.addClass(f,"valid"),i.removeClass(f,"no-valid")):(i.removeClass(f,"valid"),i.addClass(f,"no-valid")):i.removeClass(f,"valid","no-valid")}),o.propBoolean(this,"enabled")(function(t){t?i.removeAtt(v,"disabled"):i.att(v,{disabled:t})}),o.propInteger(this,"size")(function(t){t<1?i.removeAtt(v,"size"):i.att(v,{size:t})}),o.propString(this,"label")(function(t){null===t||"string"==typeof t&&""==t.trim()?i.addClass(f,"no-label"):(i.removeClass(f,"no-label"),i.textOrHtml(u,t),"<html>"==t.substr(0,6)?i.att(u,{title:""}):i.att(u,{title:t}))}),o.propString(this,"placeholder")(function(t){i.att(v,{placeholder:t})}),o.propString(this,"width")(function(t){f.style.width=t}),o.propBoolean(this,"focus")(function(t){t?v.focus():v.blur()}),o.prop(this,"action"),o.propAddClass(this,"wide"),o.propRemoveClass(this,"visible","hide"),t=o.extend({action:!0,intl:!1,value:"",type:"text",placeholder:"",enabled:!0,validator:null,valid:!0,list:null,label:"",placeholder:"",size:10,width:"auto",focus:!1,wide:!1,visible:!0},t,this);var h=function(){if(i.removeClass(f,"list"),e.list&&0!=e.list.length){i.clear(p);var t=e.list.map(String.toLowerCase),o=v.value.trim().toLowerCase();t=o.length>0?t.map(function(t,e){return[e,t.indexOf(o)]}).filter(function(t){return t[1]>-1}).sort(function(t,l){var a=t[1]-l[1];if(0!=a)return a;var i=e.list[t[0]],o=e.list[l[0]];return i<o?-1:i>o?1:0}).map(function(t){var l=e.list[t[0]],a=t[1];return l.substr(0,a)+"<b>"+l.substr(a,o.length)+"</b>"+l.substr(a+o.length)}):t.sort(),r>0&&(t=t.slice(r).concat(t.slice(0,r))),a=t,t.forEach(function(a,o){var n=i.div();n.innerHTML=a,t[o]=n.textContent.trim(),i.add(p,n),i.on(n,{down:function(){l=!0},up:function(){l=!1,e.focus=!0},tap:function(){e.value=n.textContent.trim(),i.removeClass(f,"list")}})}),t.length>0?i.addClass(f,"list"):i.removeClass(f,"list")}},m=s(function(){e.intl?(e.value[d.value]=v.value,o.fire(e,"value",e.value)):e.value=v.value},300);v.addEventListener("keyup",function(t){13==t.keyCode?(t.preventDefault(),t.stopPropagation(),i.hasClass(f,"list")?(i.removeClass(f,"list"),e.value=a[0]):e.valid!==!1&&(o.fire(e,"value",v.value),o.fire(e,"action",v.value))):27==t.keyCode?(i.removeClass(f,"list"),r=0,t.preventDefault(),t.stopPropagation()):40==t.keyCode&&i.hasClass(f,"list")?(r=(r+1)%a.length,h(),t.preventDefault(),t.stopPropagation()):38==t.keyCode&&i.hasClass(f,"list")?(r=(r+a.length-1)%a.length,h(),t.preventDefault(),t.stopPropagation()):(r=0,h(),m.fire())}),v.addEventListener("blur",function(){e.intl?(e.value[d.value]=v.value,o.fire(e,"value",e.value)):e.value=v.value,l||i.removeClass(f,"list"),i.addClass(f,"theme-elevation-2"),i.removeClass(f,"theme-elevation-8"),i.removeClass(v,"theme-color-bg-A1"),o.set(e,"focus",!1)}),v.addEventListener("focus",function(){e.selectAll(),i.removeClass(f,"theme-elevation-2"),i.addClass(f,"theme-elevation-8"),i.addClass(v,"theme-color-bg-A1"),o.set(e,"focus",!0)}),v.addEventListener("keydown",function(t){}),this.validate()};r.prototype.validate=function(){var t=this.validator;if(t)try{this.valid=t(this.value)}catch(e){console.error("[wdg.text:validate] Exception = ",e),console.error("[wdg.text:validate] Validator = ",t)}},r.prototype.selectAll=function(){var t=this._input;return t.setSelectionRange(0,t.value.length),!0},e.exports=r,e.exports._=a});
//# sourceMappingURL=wdg.text.js.map